
# Universal Rich Text Editor

나이가 있는 사용자도 쉽게 사용할 수 있도록 **유니버설 디자인**을 적용한 경량 리치 텍스트 에디터입니다. 데스크톱과 모바일 모두에서 직관적인 조작이 가능하며, **네이버 카페 등 포털 에디터에 붙여넣기 시 호환성**을 높이는 작업을 진행 중입니다.
프로젝트의 최종 목표는 **Tiptap(ProseMirror) 기반 커스텀 에디터**이며, 본 문서의 v0.8 샘플은 브라우저의 `contenteditable`과 `execCommand`를 사용하는 경량 데모입니다.

## 주요 특징

* **직관적 UI**
  굵게, 기울임, 밑줄, 목록, 정렬, 글자색, 배경색, 글자 크기, 들여쓰기 등 핵심 서식을 상단 툴바에서 즉시 사용.
* **모바일 최적화**
  모바일에서는 바텀시트로 주요 서식을 제공. 버튼 크기와 터치 영역을 확대.
* **문서 구조 요소**
  제목(H1 H3), 본문, 목록(ul ol), 인용문, 코드블록을 지원.
* **코드블록 UX**
  코드블록에 “복사” 버튼 자동 삽입.
* **멀티 모드**
  Editor, HTML, 호환 에디터 미리보기, 호환 HTML 미리보기의 4가지 모드 제공.
* **글자 수 카운트**
  실시간 글자 수 표시.

## 현재 버전과 목표 아키텍처

* **v0.8 데모**

  * 표면: `contenteditable` + `document.execCommand` 중심의 커스텀 구현
  * 목적: UX 검증, 호환 HTML의 아웃라인 설계, 모바일 바텀시트 상호작용 확인
* **목표**

  * 내부 문서 모델을 **Tiptap(ProseMirror Schema)** 로 전환
  * 붙여넣기와 내보내기 단계에서 **정규화 파이프라인**을 통해 포털 호환성 확보

> 비고: 네이버 스마트에디터 2.0은 구버전으로 간주. 본 프로젝트는 포털의 sanitize 정책을 고려한 **Portable HTML Profile**을 채택합니다.

## 호환성 전략

### Portable HTML Profile v1

다른 에디터에서도 거의 동일하게 렌더되도록 최소·보편 태그만 사용합니다.

* 블록: `p`, `h1~h3`, `ul/ol/li`, `blockquote`, `pre`, `hr`
* 인라인: `strong`, `em`, `u`, `a[href]`, `code`, `br`, `span`
* 허용 인라인 스타일: `color`, `background-color`, `font-size(px)`, `text-align`, `padding-left`
* 금지: `font`, `center`, 임의 `data-*`, 인라인 이벤트 `on*`
* 규칙: `blockquote`와 `pre`는 동일 줄에 동시에 존재하지 않도록 강제

### 네이버 카페 호환 흐름

1. **편집**: 사용자가 자유롭게 작성
2. **HTML 보기**: 내부 HTML을 확인하고 정리
3. **호환 HTML 생성**: 포털 정책을 고려해 문단 중심 구조로 변환
4. **호환 에디터 미리보기**: 포털에서 보일 모습을 에뮬레이션
5. **붙여넣기**: 포털 본문에 호환 HTML을 붙여넣기

v0.8에는 `generateNaverHTML()`이 포함되어 있으며, 현재는 기본 규칙으로 `<p>/<div>`를 줄바꿈 중심으로 정리하고 `blockquote`를 제거합니다. 
다음 단계에서 DOMPurify 기반 정규화와 더 정교한 문단 분리, 스타일 화이트리스트를 적용합니다.

## 접근성·유니버설 디자인

* 충분한 버튼 크기와 간격, 명확한 아이콘, 일관된 위치.
* 모바일 바텀시트로 손가락 조작성을 강화.
* 색상 대비와 명확한 상태 피드백(활성 버튼, 복사 완료 등) 제공.
* 키보드 단축키 제공.

  * `Ctrl/⌘ + B` 굵게, `Ctrl/⌘ + I` 기울임, `Ctrl/⌘ + U` 밑줄
  * 인용문·코드 토글 시 선택 유지

## 파일 구성과 작동 방식

* 단일 HTML 파일로 실행되며 외부 의존성은 CDN으로 로드

  * Tailwind CSS, Font Awesome, jQuery
* 에디터 본문: `<div id="editor" contenteditable="true">`
* 상단 툴바, 모바일 바텀시트, 모드 전환 탭으로 구성
* 선택 보존: 선택 시작·끝에 임시 `<span>` 마커를 삽입 후 복원
* 인용문/코드 토글: 대상 블록을 찾아 래핑 또는 언랩

## 빠른 시작

로컬에서 파일을 더블 클릭하거나 간단한 정적 서버로 열면 됩니다.

```bash
# 예시
python -m http.server 8000
# 브라우저에서 http://localhost:8000/index.html
```

## 빌드와 배포

현재는 번들링 없이 단일 HTML로 동작합니다. 운영 환경에서는 아래를 권장합니다.

* Tailwind를 JIT 대신 정적 빌드로 추출
* DOMPurify 추가 및 버전 고정
* 에셋 무결성 검증(SRI)과 CSP 적용

## 로드맵

1. **포털 호환 HTML 정규화 고도화**

   * DOMPurify 적용
   * `b/i`를 `strong/em`으로 승격
   * `font[color]`를 `span style=color`로 변환
   * 다중 `<br>` 문단 승격
   * 스타일 화이트리스트만 유지
   * `blockquote`와 `pre` 동시 존재 시 구조 정리
2. **Tiptap 전환**

   * ProseMirror 스키마 정의
   * 붙여넣기 훅과 export 훅에서 Portable HTML Profile 강제
   * 실시간 협업(Y.js) 옵션 검토
3. **QA 자동화**

   * 포털별 렌더 스냅샷 비교 테스트
   * 크로스 브라우저 테스트
4. **플러그인화**

   * “포털용 복사” 버튼 및 정규화 유틸을 별도 모듈로 분리

## 제한 사항

* `document.execCommand`는 점진적으로 폐지되는 API입니다. 크로스 브라우저에서 동작하지만 장기적으로 Tiptap 전환을 권장합니다.
* 표, 이미지, 멘션, 인라인 위젯 등은 미지원. 필요 시 Tiptap로 마이그레이션하면서 추가합니다.

